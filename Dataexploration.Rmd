---
title: "Exploratory Analysis"
author: "Eva Jason"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
library(tidyr)
library(kableExtra)
library(lmtest)
library(car)
library(UpSetR)
library(RColorBrewer)

source("hoslemv2.R")
```

```{r}
df_all <- read.csv("../HPS_Week17_PUF_CSV/pulse2020_puf_17.csv") 
```

```{r}
# "issue" corresponds to 0 if yours score is < 4 and 1 if your score is > 4
df <- mutate(df_all, age = 2023-TBIRTH_YEAR) %>%
  mutate(ANXIOUS = ifelse(ANXIOUS < 1, 0, ANXIOUS)) %>%
  mutate(WORRY = ifelse(WORRY < 1, 0, WORRY)) %>%
  mutate(INTEREST = ifelse(INTEREST < 1, 0, INTEREST)) %>%
  mutate(DOWN = ifelse(DOWN < 1, 0, DOWN)) %>%
  mutate(mental_health_score = rowSums(pick(ANXIOUS,WORRY,INTEREST,DOWN))) %>%
  mutate(issue = ifelse(mental_health_score<=4, 0, 1)) %>%
  mutate(age_group = case_when(
    age < 30 ~ "20-29",
    age < 40 & age > 29 ~ "30-39",
    age < 50 & age > 39 ~ "40-49",
    age < 60 & age > 49 ~ "50-59",
    age < 70 & age > 59 ~ "60-69",
    age < 80 & age > 69 ~ "70-79",
    age > 79 ~ "80+"
  )) %>%
  mutate(TW_START = as.character(TW_START)) %>%
  mutate(school_children = ifelse(ENROLL1 ==1 | ENROLL2==1, T, F))
```

## Summary Statistics

```{r}
ggplot(df, aes(age)) +
  geom_bar() +
  theme_minimal()

avg_age <- mean(df$age)
median_age <- median(df$age)
```

A total of `r nrow(df)` responded to the Week 17 survey.

The average age of respondents was `r round(avg_age,2)` and the median age was  `r round(median_age,2)`.

```{r}
df_mental_health <- select(df, ANXIOUS, WORRY, INTEREST, DOWN, age_group) %>%
  pivot_longer(cols = c(ANXIOUS,WORRY,INTEREST,DOWN), names_to ="issue", values_to = "score")

df_groups <- group_by(df_mental_health, issue, age_group, score) %>%
  summarise(total_issue_age_score = n())

df_groups_age_group_total_score <-  group_by(df_mental_health, age_group, issue) %>%
  summarise(total_issue_age = n())

df_groups <- merge(df_groups, df_groups_age_group_total_score) %>%
  mutate(percent = total_issue_age_score/total_issue_age)

ggplot(df_groups, aes(x=score, y = percent)) +
  geom_col() +
  facet_grid(issue~age_group) +
  theme_minimal()
```

ANXIOUS:

"Over the last 7 days, how often have you been bothered by the following problems ... Feeling
nervous, anxious, or on edge? Would you say not at all, several days, more than
half the days, or nearly every day? Select only one answer."

WORRY:

"Over the last 7 days, how often have you been bothered by the following problems ... Not being
able to stop or control worrying? Would you say not at all, several days, more
than half the days, or nearly every day? Select only one answer."

INTEREST:

"Over the last 7 days, how often have you been bothered by ... having little interest or
pleasure in doing things? Would you say not at all, several days, more than
half the days, or nearly every day? Select only one answer."

DOWN:

"Over the last 7 days, how often have you been bothered by ... feeling down, depressed, or
hopeless? Would you say not at all, several days, more than half the days, or
nearly every day? Select only one answer."

1) Not at all
2) Several days
3) More than half the days
4) Nearly every day 
-99) Question seen but category not selected
-88) Missing / Did not report"

Missing data was considered as if they did not experience the issue.

```{r}
df_groups_y_n_issue <- group_by(df, issue, age_group) %>%
  summarise(total_issue_age_score = n())

df_groups_age_group <-  group_by(df, age_group) %>%
  summarise(total_age_group = n())

df_groups <- merge(df_groups_y_n_issue, df_groups_age_group) %>%
  mutate(percent = total_issue_age_score/total_age_group)%>%
  mutate(has_issue = ifelse(issue ==1, "YES", "NO"))

ggplot(df_groups, aes(x=age_group, y = percent, fill = has_issue)) +
  geom_col(position="dodge") +
  theme_minimal() +
  theme(legend.title = "Has Mental Health Issue") +
  ylab("Percent with Issue") +
  xlab("Age Group")
```

```{r}
mod.fit <- glm(formula = issue ~ age, family = binomial(link = logit), data = df)

df$fitted.values <- mod.fit$fitted.values

ggplot(df, aes(x = age, y = fitted.values)) +
  geom_line() +
  theme_minimal()
```

```{r}
education_level <- select(df,EEDUC) %>% 
  mutate(EEDUC = as.character(EEDUC)) %>%
  group_by(EEDUC) %>%
  summarise(total = n())

tele_work <- select(df,TW_START) %>% 
  mutate(TW_START = as.character(TW_START)) %>%
  group_by(TW_START) %>%
  summarise(total = n()) %>%
  mutate(percent = paste0(round(total/nrow(df),2)*100,"%"))

kable(tele_work)  #%>%
  #save_kable("telework.pdf")
```
Working from home is sometimes referred to as telework. Did any adults in this household substitute some or all of their typical in-person work for telework because of the coronavirus pandemic, including yourself?  Select only one answer.

Teleworking start due to COVID
"1) Yes, at least one adult substituted some or all of their typical in-person work for telework
2) No, no adults substituted their typical in-person work for telework
3) No, there has been no change in telework
-99) Question seen but category not selected
-88) Missing / Did not report"


```{r}
df_activity <- select(df,FEWRTRANS,PLNDTRIPS,CNCLDTRPS,TW_START,CHNGHOW1,CHNGHOW2,CHNGHOW3,CHNGHOW4,CHNGHOW5,CHNGHOW6,CHNGHOW7,CHNGHOW8,CHNGHOW9,CHNGHOW10,CHNGHOW11,CHNGHOW12)
  
df_change <- select(df, starts_with("CHNGHOW"))

df_change[df_change == -99] <- 0
df_change[df_change == -88] <- 0

df_total_change <- colSums(df_change)

df_change <- data.frame(category = colnames(df_change), total =colSums(df_change)) %>%
  mutate(total = as.numeric(total)) %>%
  mutate(percentage = total/nrow(df_change)) %>%
  mutate(percent = paste0(round(percentage, 2)*100, "%"))

kable(select(df_change, category, percent), row.names = F)
```


How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Made more purchases online (as opposed to in store)
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Made more purchases by curbside pick-up (as opposed to in store)
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) More purchases in-store (as opposed to purchases online or curbside pickup)
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Increased use of credit cards or smartphone apps for purchases, instead of using cash 
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Increased use of cash instead of using credit cards or smartphone apps for purchases
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Avoided eating at restaurants
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Resumed eating at restaurants
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Canceled or postponed in-person medical or dental appointments 
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Attended in-person medical or dental appointments
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Canceled or postponed housekeeping or caregiving services
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Resumed or started new housekeeping or caregiving services 
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	
	
How did spending or shopping change	In the last 7 days, which of the following changes have you or your household made to your spending or shopping? Select all that apply. 
"1) Did not make any changes to spending or shopping behavior
-99) Question seen but category not selected
-88) Missing / Did not report"	
All persons born before 2002	


## CHNGHOW + WHYCHNGD

```{r}
# changed_shopping_habits_online = 1 means Made more purchases online (as opposed to in store)
# changed_shopping_habits_online = 0 means didn't Made more purchases online (as opposed to in store)

# changed_shopping_habits_curbside = 1 Made more purchases by curbside pick-up (as opposed to in store)
# changed_shopping_habits_curbside = 0 didn't Made more purchases by curbside pick-up (as opposed to in store)

# change_restaurants = 1 Avoided eating at restaurants
# change_restaurants = 0 didn't Avoided eating at restaurants

# change_appointments = 1 Canceled or postponed in-person medical or dental appointments 
# change_appointments = 0 didn't Canceled or postponed in-person medical or dental appointments 

# change_caregiving =1 Canceled or postponed housekeeping or caregiving services
# change_caregiving = 0 didn't Canceled or postponed housekeeping or caregiving services

df <- mutate(df, changed_shopping_habits_online = ifelse(CHNGHOW1 == 1, 1, 0)) %>%
  mutate(changed_shopping_habits_curbside = ifelse(CHNGHOW2 == 1, 1, 0)) %>%
  mutate(changed_restaurants = ifelse(CHNGHOW6 == 1, 1, 0)) %>%
  mutate(changed_appointments = ifelse(CHNGHOW8 == 1, 1, 0)) %>%
  mutate(changed_caregiving = ifelse(CHNGHOW10 == 1, 1, 0)) %>%
  mutate(total_changed = rowSums(select(.,starts_with("changed")))) %>%
  mutate(changed_bin = total_changed >0) %>%
  mutate(change_due_to_risk = WHYCHNGD3 ==1 ) %>%
  mutate(behavior_change_due_risk = changed_bin & change_due_to_risk)

#behavior_change_due_risk is true if the person changed their behavior because of high risk
```

## planned trips 

```{r}
# canceled_trip_due_to_covid TRUE means "Were any of these trips canceled because of the coronavirus pandemic? Include trips you had not made travel reservations or arrangements for in your answer. Select only one answer."
# FALSE means they didn't cancel due to covid or didn't have a trip planned
df <- mutate(df, canceled_trip_due_to_covid = CNCLDTRPS==1)
```

## remote learning for children

```{r}
# if there were children at home, did they stop going in person
df <- mutate(df, children_learn_from_home = ifelse(TEACH1 == 1 | TEACH2 == 1 | TEACH3 == 1, T, F))
```

```{r}
#if they started telework, then it is TRUE
df <- mutate(df, telework = TW_START== 1)
```
"1) Yes, at least one adult substituted some or all of their typical in-person work for telework
2) No, no adults substituted their typical in-person work for telework
3) No, there has been no change in telework
-99) Question seen but category not selected
-88) Missing / Did not report"

```{r}
#if they took fewer trips to stores, then it is TRUE
df <- mutate(df, fewer_trips = FEWRTRIPS == 1)
```

```{r}
#if they took fewer trips on transit, then it is TRUE
df <- mutate(df, fewer_trips_transit = FEWRTRANS == 1) %>%
  mutate(race = as.character(RRACE))

df_mod <- select(df, race, issue, telework,fewer_trips,fewer_trips_transit,children_learn_from_home,behavior_change_due_risk,canceled_trip_due_to_covid)
```


```{r}
df2 <- group_by(df_mod, race) %>% 
  summarise(across(everything(), sum), total_each_race = n()) %>%
  pivot_longer(-c(race,total_each_race), names_to = "activity", values_to = "total_people") %>%
  mutate(percent_total = (total_people/total_each_race))

ggplot(df2, aes(x = activity, y = percent_total, fill = race)) + 
  geom_bar(position="dodge", stat="identity") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 90, hjust=.2)) +
  ylim(c(0,1))

df_mod <- select(df, age_group, telework,fewer_trips,fewer_trips_transit,children_learn_from_home,behavior_change_due_risk,canceled_trip_due_to_covid)
df3 <- group_by(df_mod, age_group) %>% 
  summarise(across(everything(), sum), total_each_age_group = n()) %>%
  pivot_longer(-c(age_group,total_each_age_group), names_to = "activity", values_to = "total_people") %>%
  mutate(percent_total = (total_people/total_each_age_group))

ggplot(df3, aes(x = activity, y = percent_total, fill = age_group)) + 
  geom_bar(position="dodge", stat="identity") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 90, hjust=.2)) +
  ylim(c(0,1))
```
stratified analysis for age groups or maybe look at younger people. 

maybe the fitted values are not the most important part of the store, look at the estimated the effects


## Variable Selection

```{r}
mod.fit <- glm(issue ~ telework + fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid + age, family = binomial, data=df)

mod.fit_age <- glm(issue ~ (telework + fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid)*age_group, family = binomial, data=df)

#mod.fit_age_no_age <- glm(issue ~ telework + fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid, family = binomial, data=df)
lrtest(mod.fit, mod.fit_age)
```

```{r}
df_summary <- summary(mod.fit_age)$coefficients %>% 
  data.frame()

df_summary$variables <- rownames(df_summary)
df_summary <- separate(df_summary, variables, into = c('variable', 'age_group'), sep = ":", remove = FALSE) %>%
  #mutate(age_group = replace_na(age_group, "age_group"))
  mutate(age_group = coalesce(age_group, variable)) %>%
  mutate(significance = ifelse(Pr...z.. < 0.01, "significant", "not significant"))

age_groups <- df_summary$age_group %>% unique()
age_groups <- age_groups[8:length(age_groups)]

df_summary <- mutate(df_summary, variable = ifelse(variable %in% age_groups, "age_group", variable))

#df_summary <- df_summary[df_summary[9:14,6] = "age_group"]
df_summary <- df_summary[8:nrow(df_summary),]

ggplot(df_summary, aes(x= age_group, y = Estimate, group=variable)) +
  geom_line(aes(color = variable)) +
  geom_point(aes(shape = significance)) +
  scale_size_manual(values=c(10,1)) +
  scale_shape_manual(values=c(16, 8)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

df_summary[,1:4] %>% signif(3) %>% kable
```
Use cutoff of 60 because these people were more likely to change their behavior

```{r}
df_young <- filter(df, age < 60)

mod.fit_young_interaction <- glm(issue ~ (telework + fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid)*age_group, family = binomial, data=df_young)
mod.fit_young_interaction$aic

mod.fit_young <- glm(issue ~ telework + fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid + age_group, family = binomial, data=df_young)
mod.fit_young$aic

mod.fit_young_cont <- glm(issue ~ telework + fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid + age, family = binomial, data=df_young)
mod.fit_young_cont$aic

lrtest(mod.fit_young_cont, mod.fit_young)

mod.fit_no_age <- glm(issue ~ telework + fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid, family = binomial, data=df_young)
mod.fit_no_age$aic

a <- anova(mod.fit_young_interaction, mod.fit_young)
lrtest(mod.fit_young_interaction, mod.fit_young)
lrtest(mod.fit_no_age, mod.fit_young)

hoslem(df_young$issue, mod.fit_young_cont$fitted.values)
hoslem(df_young$issue, mod.fit_young$fitted.values)

pchisq(mod.fit_young_cont$deviance, mod.fit_young_cont$df.residual, lower.tail = F)
plot(mod.fit_no_age)
```


```{r, eval=F}
df_agg_all_var <- group_bydf_young, telework, fewer_trips, age, fewer_trips_transit, children_learn_from_home, behavior_change_due_risk, canceled_trip_due_to_covid) %>%
  summarize(n = n(), total_w_issue = sum(issue)) %>%
  mutate(RR = total_w_issue/n)

mod.fit_young_cont_agg <- glm(issue/n ~ telework + fewer_trips + age+ fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid, family = binomial, data=df_young_agg_all_var, weights = n)

pchisq(mod.fit_young_cont_agg$deviance, mod.fit_young_cont_agg$df.residual, lower.tail = F)
plot(mod.fit_young_cont_agg)
mod.fit_young_cont_agg$aic
```

```{r, eval=F}
df_young_agg_all_var_no_age <- group_by(df_young, issue, telework, fewer_trips, fewer_trips_transit, children_learn_from_home, behavior_change_due_risk, canceled_trip_due_to_covid) %>%
  summarize(n = n(), total_w_issue = sum(issue)) %>%
  mutate(RR = total_w_issue/n)

mod.fit_young_cont_agg_no_age <- glm(issue/n ~ fewer_trips + fewer_trips_transit + telework + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid, family = binomial, data=df_young_agg_all_var_no_age, weights = n)

pchisq(mod.fit_young_cont_agg_no_age$deviance, mod.fit_young_cont_agg_no_age$df.residual, lower.tail = F)
plot(mod.fit_young_cont_agg_no_age)
mod.fit_young_cont_agg_no_age$aic
```

```{r, eval=F}
df_young_agg_all_var_no_age_no_tele <- group_by(df_young, issue, fewer_trips, fewer_trips_transit, children_learn_from_home, behavior_change_due_risk, canceled_trip_due_to_covid)  %>%
  summarize(n = n(), total_w_issue = sum(issue)) %>%
  mutate(RR = total_w_issue/n)

mod.fit_young_cont_agg_no_age_no_tele <- glm(RR ~ fewer_trips + fewer_trips_transit + children_learn_from_home + behavior_change_due_risk + canceled_trip_due_to_covid, family = binomial, data=df_young_agg_all_var_no_age_no_tele, weights = n)

pchisq(mod.fit_young_cont_agg_no_age_no_tele$deviance, mod.fit_young_cont_agg_no_age_no_tele$df.residual, lower.tail = F)
plot(mod.fit_young_cont_agg_no_age_no_tele)
mod.fit_young_cont_agg_no_age_no_tele$aic
```

BEST MODEL:

```{r}
df_agg <- group_by(df_young, fewer_trips, fewer_trips_transit, children_learn_from_home, canceled_trip_due_to_covid) %>%
  summarize(n = n(), total_w_issue = sum(issue)) %>%
  mutate(RR = total_w_issue/n)

mod.fit <- glm(RR ~ fewer_trips + fewer_trips_transit + children_learn_from_home + canceled_trip_due_to_covid, family = binomial, data=df_agg, weights = n)

pchisq(mod.fit$deviance, mod.fit$df.residual, lower.tail = F)
plot(mod.fit)

influencePlot(mod.fit)
summary(mod.fit)

print(mod.fit$aic) %>% round(2)

df_agg$fitted <- mod.fit$fitted.values
```

```{r}
expit <- function(x){
  exp(x) /  ( 1 + exp(x))
}
```

When a person reported in the survey that they stopped going to the store due to covid, there was a 215% increase in the probability of depression compared to those who continued going to the store. 

```{r}
estimate <- summary(mod.fit)$coefficients[,1] %>% round(2)
prob_change <- round(exp(summary(mod.fit)$coefficients[,1])-1 %>% as.numeric(),2)
std_err <- summary(mod.fit)$coefficients[,2] %>% round(2)
p_val <- formatC(summary(mod.fit)$coefficients[,4], format = "e", digits = 2)

df_coef_final <- cbind(estimate, prob_change, std_err, p_val)
rownames(df_coef_final) <- c("Intercept", "Fewer Trips to Store", "Fewer Trips on Transit", "Remote Learning", "Canceled Vacation")
colnames(df_coef_final) <- c("Estimate", "Probability Change", "Std. Error", "p-value")
k1 <- kable(df_coef_final, "latex", booktabs = T) %>%
  kable_styling(latex_options = c("scale_down")) %>%
  as_image()
k1
#save_kable(k1, "coef_final.png")

df_upset_1 <- filter(df_young, issue ==1) %>%
  select(fewer_trips, fewer_trips_transit, children_learn_from_home, canceled_trip_due_to_covid)

colnames(df_upset_1) <- c("Fewer Trips to Store", "Fewer Trips on Transit", "Remote Learning", "Canceled Vacation")
cols <- sapply(df_upset_1, is.logical)
df_upset_1[,cols] <- lapply(df_upset_1[,cols], as.numeric)

png(file="upset.png", width = 1000, height = 1000) # or other device
upset(df_upset_1, nset=ncol(df_upset_1), order.by="freq")
dev.off()
# df_upset_0 <- filter(df_young, issue == 0) %>%
#   select(fewer_trips, fewer_trips_transit, children_learn_from_home, canceled_trip_due_to_covid)
# cols <- sapply(df_upset_0, is.logical)
# df_upset_0[,cols] <- lapply(df_upset_0[,cols], as.numeric)
# upset(df_upset_0, nset=ncol(df_upset_0), order.by="freq")

df_agg$fitted_val <- mod.fit$fitted.values

```

```{r}
df_agg <- arrange(df_agg, desc(fitted_val))# %>%
  
df_agg$Rank <- seq(1,nrow(df_agg),1)
df_agg$total <- df_agg$fewer_trips + df_agg$fewer_trips_transit + df_agg$children_learn_from_home + df_agg$canceled_trip_due_to_covid
ggplot(df_agg, aes(x = factor(Rank), y = fitted_val,color = factor(total))) +
  #geom_col(aes(fill = factor(total))) +
  geom_point(size = 3) +
  theme_minimal() +
  xlab("Rank") +
  ggtitle("Probability of a Mental Health Issue") +
  ylab("Probability") +
  ylim(c(0,1)) +
  labs(color = "Number of Activities Changed")  +
  theme(legend.position="bottom")
  
ggsave("rank_fit_values.png")
df_agg_table <- select(df_agg,fewer_trips, fewer_trips_transit, children_learn_from_home, canceled_trip_due_to_covid, fitted_val)
df_agg_table$fitted_val <- round(df_agg_table$fitted_val, 3)

colnames(df_agg_table) <-  c("Fewer Trips to Store", "Fewer Trips on Transit", "Remote Learning", "Canceled Vacation", "Probability of a Mental Health Issue")
df_agg_table$`Probability of a Mental Health Issue` <- round(df_agg_table$`Probability of a Mental Health Issue`, 2)
df_agg_table_k <- kable(df_agg_table, "latex", booktabs = T) %>%
  kable_styling(latex_options = c("scale_down")) %>%
  as_image()
df_agg_table_k
```

